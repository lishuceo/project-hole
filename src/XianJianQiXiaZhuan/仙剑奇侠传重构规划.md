# 🗡️ 仙剑奇侠传重构规划文档

## 📋 项目概述

基于 ARPGTemplate 的成熟架构，重构现有的仙剑奇侠传项目，创建一个**简化但完整**的仙剑风格 RPG 游戏。

### 🎯 设计目标
- ✅ **可游玩性**：有明确的游戏循环和目标
- ✅ **仙剑风格**：角色、技能、场景符合仙剑奇侠传主题
- ✅ **系统完整性**：基本 RPG 要素齐全
- ❌ **不追求**：复杂剧情、大量内容、完美还原原作

---

## 🔍 ARPGTemplate 分析总结

### 核心架构模式
1. **模块化设计**：Server/Client 分离，ScopeData 子系统分离
2. **事件驱动**：使用 Trigger 系统处理游戏事件 (`EventGameStart`, `EventGameTick`)
3. **延迟初始化**：等待玩家和主单位就绪后再初始化 UI
4. **动态创建**：服务端动态创建 AI 敌人单位
5. **完整的游戏系统**：技能、背包、升级、AI、UI 等

### 关键技术特点
- 使用 `AIThinkTree.AddDefaultAI()` 为敌人添加 AI
- 完整的 UI 系统：`AbilityJoyStickGroup`, `DefaultInventoryUI`, `QuickBarUI`, `PickButton`, `MoveKeyBoard`
- 规范的资源管理和错误处理
- 支持多职业系统（剑客、枪手、法师、战士）
- 动态单位创建：`Unit.CreateUnit(ownerPlayer, scenePoint, rotation)`

---

## 📋 核心 RPG 要素规划

### 1. 角色系统 👥

#### 主要角色
- **李逍遥**：主角，玩家控制，剑客职业
- **赵灵儿**：队友，AI 控制，法师职业  
- **林月如**：队友，AI 控制，战士职业

#### 敌人分层
- **普通怪物**：蛇妖、树妖 (血量 100-200)
- **精英怪物**：蜀山剑士 (血量 300-500)
- **BOSS 级别**：黑白无常、剑魔 (血量 800-1500)
- **终极 BOSS**：特殊设计的最终挑战

#### NPC 角色
- **姜子牙**：任务发布者，提供主线任务
- **剑仙**：技能导师，提供技能升级

### 2. 战斗系统 ⚔️

#### 战斗机制
- **实时战斗**：类似 ARPG 的即时战斗
- **技能冷却**：每个技能有独立的冷却时间
- **目标锁定**：自动或手动锁定敌人
- **伤害计算**：基础攻击力 + 技能倍率 - 敌人防御

#### 技能系统
**李逍遥技能**：
- 剑气斩：远程攻击技能，发射剑气
- 仙风云体术：增加移动速度和闪避
- 酒神咒：回复生命值
- 天剑：终极技能，大范围伤害

**赵灵儿技能**：
- 五雷咒：雷电攻击
- 治疗术：恢复队友生命
- 护体神咒：提供护盾
- 女娲神力：群体治疗

**林月如技能**：
- 破甲击：无视部分防御
- 连击：连续攻击
- 战意激发：提升攻击力
- 剑舞：范围攻击

### 3. 属性系统 📊

#### 基础属性
- **生命值 (HP)**：角色的生存能力
- **法力值 (MP)**：技能消耗的资源
- **攻击力 (ATK)**：物理伤害基础值
- **防御力 (DEF)**：减少受到的伤害
- **速度 (SPD)**：移动和攻击速度

#### 扩展属性
- **经验值 (EXP)**：用于升级
- **等级 (Level)**：1-20 级
- **暴击率**：造成双倍伤害的概率
- **暴击伤害**：暴击时的伤害倍率

### 4. 物品系统 🎒

#### 装备类型
**武器**：
- 木剑 (攻击+10)
- 铁剑 (攻击+25) 
- 仙剑 (攻击+50)
- 镇妖剑 (攻击+100)

**防具**：
- 布衣 (防御+5)
- 皮甲 (防御+15)
- 锁子甲 (防御+30)
- 仙衣 (防御+60)

#### 消耗品
- **回血丹**：恢复 50% 生命值
- **回魔丹**：恢复 50% 法力值  
- **大还丹**：完全恢复生命和法力
- **经验丹**：获得额外经验值

#### 任务物品
- **仙灵珠**：主线任务关键道具
- **锁妖塔钥匙**：开启最终区域
- **古书残页**：支线任务收集品

### 5. 场景系统 🌍

#### 场景设计
**余杭镇** (起始区域)：
- 安全区域，无敌人
- NPC 集中地：姜子牙、商人、任务发布者
- 传送点：连接其他区域

**仙灵岛** (中期区域)：
- 普通和精英怪物
- 隐藏宝箱和秘密区域
- 支线任务地点

**锁妖塔** (终极区域)：
- 高难度敌人和 BOSS
- 最终挑战和奖励
- 多层塔结构

### 6. 任务系统 📜

#### 主线任务
1. **初入江湖**：熟悉基本操作和战斗
2. **寻找灵珠**：前往仙灵岛收集仙灵珠
3. **锁妖塔的秘密**：调查锁妖塔异常
4. **最终决战**：击败塔顶的终极 BOSS
5. **拯救苍生**：完成最终目标

#### 支线任务
1. **收集药材**：为 NPC 收集特定物品
2. **清理怪物**：消灭指定区域的敌人
3. **寻找古籍**：收集散落的古书残页

---

## 🔄 实施计划

### 第一阶段：核心框架重构 (优先级：🔥🔥🔥)

#### 1.1 架构重构
- [ ] 参考 ARPGTemplate 重构 `XianJianServer.cs`
- [ ] 重构 `XianJianClient.cs` 的 UI 初始化逻辑
- [ ] 建立标准的事件驱动系统 (Trigger)
- [ ] 实现延迟初始化机制

#### 1.2 核心系统
- [ ] 完善角色属性和技能系统
- [ ] 实现基础战斗循环
- [ ] 添加经验和升级系统
- [ ] 优化 AI 系统集成

#### 1.3 测试验证
- [ ] 确保基础游戏循环可运行
- [ ] 验证技能释放和伤害计算
- [ ] 测试 UI 交互和响应

### 第二阶段：游戏系统完善 (优先级：🔥🔥)

#### 2.1 物品系统
- [ ] 实现装备系统和属性加成
- [ ] 完善背包和物品管理
- [ ] 添加商店和交易功能

#### 2.2 敌人和 AI
- [ ] 使用 `AIThinkTree.AddDefaultAI()` 为敌人添加智能
- [ ] 实现动态敌人生成系统
- [ ] 设计不同难度的敌人类型

#### 2.3 场景和关卡
- [ ] 完善三个主要场景的设计
- [ ] 添加场景间的传送机制
- [ ] 实现场景特有的挑战和奖励

### 第三阶段：内容和体验 (优先级：🔥)

#### 3.1 任务系统
- [ ] 实现基础任务框架
- [ ] 添加主线和支线任务
- [ ] 设计任务奖励和进度跟踪

#### 3.2 游戏平衡
- [ ] 调整角色属性和技能数值
- [ ] 平衡敌人难度和奖励
- [ ] 优化游戏节奏和体验

#### 3.3 最终优化
- [ ] 添加音效和视觉反馈
- [ ] 优化 UI 和用户体验
- [ ] 最终测试和 bug 修复

---

## 🚫 明确不做的事情

### 复杂功能 (避免过度开发)
- ❌ **复杂剧情对话系统**：只做基础交互和简单对话
- ❌ **大量动画和特效**：使用现有资源，不自制复杂特效
- ❌ **复杂的装备属性系统**：简化为基础的攻击、防御、生命
- ❌ **多结局和分支剧情**：线性主线即可
- ❌ **复杂的组队系统**：单人控制主角，队友简化 AI

### 内容限制 (控制开发范围)
- ❌ **大量场景**：只做 3 个核心场景
- ❌ **海量装备**：每类装备 4-5 种即可
- ❌ **复杂技能树**：每角色 4 个核心技能
- ❌ **多职业系统**：专注于 3 个主要角色

---

## 💡 实现策略和技术要点

### 开发原则
1. **借鉴成熟模板**：大量参考 ARPGTemplate 的架构和实现
2. **渐进式开发**：每个阶段都保证游戏可运行和测试
3. **内容复用**：充分利用现有的模型和动画资源
4. **简化优先**：遇到复杂问题时选择简化方案

### 关键技术点
1. **事件系统**：`Trigger<EventGameStart>`, `Trigger<EventGameTick>`
2. **AI 系统**：`AIThinkTree.AddDefaultAI(unit)`
3. **UI 系统**：`AbilityJoyStickGroup`, `DefaultInventoryUI`, `MoveKeyBoard`
4. **单位创建**：`Unit.Data?.CreateUnit(ownerPlayer, scenePoint, rotation)`
5. **延迟初始化**：等待 `Player.LocalPlayer.MainUnit` 就绪

### 资源管理
- **模型资源**：使用 `ModelAsset.cs` 中定义的现有模型
- **技能图标**：使用 `SkillIconAsset.cs` 中的 PNG 图标
- **动画映射**：标准化动画名称映射 (idle, move, attack, skill1-4)

---

## 📊 当前状态和下一步

### 已完成 ✅
- [x] 基础项目结构创建
- [x] 角色和技能定义 
- [x] 模型和动画配置
- [x] 基础场景设置
- [x] 技能图标系统

### 下一步行动 🎯
1. **立即开始第一阶段重构**：参考 ARPGTemplate 重构服务端架构
2. **重点关注**：事件驱动系统和延迟初始化
3. **测试验证**：确保重构后的基础功能正常

### 风险和注意事项 ⚠️
- **避免功能蔓延**：严格按照规划，不添加计划外功能
- **及时测试**：每个阶段完成后立即测试验证
- **保持简化**：遇到技术难点时优先选择简化方案
- **文档更新**：重大变更时及时更新此规划文档

---

*文档创建时间：2024年*  
*最后更新：待更新*  
*状态：规划阶段*


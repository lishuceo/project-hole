# 五子棋游戏 (Gomoku Game)

本项目实现了一个完整的多人五子棋游戏，使用框架的客户端-服务器架构，确保游戏逻辑在服务端运行以防止作弊。

## 功能特性

- ✅ **服务端游戏逻辑**：所有游戏逻辑在服务器端运行，确保公平性
- ✅ **实时同步**：使用框架的消息系统实现客户端-服务器实时同步
- ✅ **双人对战**：支持2个玩家同时游戏（玩家1和玩家5）
- ✅ **完整UI界面**：美观的游戏棋盘和状态显示
- ✅ **获胜检测**：自动检测五子连线获胜条件
- ✅ **游戏重启**：支持重新开始游戏功能
- ✅ **错误处理**：完善的错误消息提示系统

## 游戏规则

1. **棋盘**：15x15 的标准五子棋棋盘
2. **玩家**：
   - 玩家1（ID: 1）执黑棋，先手
   - 玩家5（ID: 5）执白棋，后手
3. **获胜条件**：横、竖、斜任意方向连成5子即获胜
4. **回合制**：玩家轮流落子，不能在已有棋子的位置落子
5. **平局**：棋盘下满无人获胜即为平局

## 文件结构

```
Tests/Game/Gomoku/
├── README.md                 # 本说明文档
├── GomokuGame.cs            # 核心游戏逻辑和数据结构
└── GomokuClientUI.cs        # 客户端UI界面
```

## 技术架构

### 服务端 (`GomokuServerManager`)
- 维护游戏状态（棋盘、当前玩家、游戏阶段）
- 验证玩家落子的合法性
- 检测获胜条件和游戏结束
- 广播游戏状态更新给所有客户端
- 处理游戏重启请求

### 客户端 (`GomokuClientUI`)
- 显示15x15棋盘界面
- 处理玩家点击交互
- 发送落子请求到服务器
- 接收并显示服务器状态更新
- 提供游戏控制按钮（开始/重启）

### 网络通信
使用框架的 `ProtoCustomMessage` 系统进行通信：

- **消息类型**：
  - `PlaceStone`: 落子请求
  - `GameStateUpdate`: 游戏状态更新
  - `GameOver`: 游戏结束通知
  - `RestartGame`: 重新开始请求
  - `Error`: 错误消息

## 如何运行

1. **配置游戏模式**：
   - 在 `GlobalConfig.cs` 中五子棋模式已添加到可用游戏模式列表
   - 设置 `GameDataGlobalConfig.TestGameMode = ScopeData.GameMode.Gomoku;` 来默认启动五子棋模式

2. **启动游戏**：
   - 确保有两个玩家连接（ID为1和5）
   - 游戏会自动初始化并等待玩家开始

3. **游戏操作**：
   - 点击棋盘格子落子
   - 使用"开始游戏"按钮开始新游戏
   - 使用"重新开始"按钮重置游戏

## 游戏界面

### 棋盘区域
- 15x15 圆形按钮组成的棋盘
- 黑色圆圈代表黑棋，白色圆圈代表白棋
- 木色背景模拟真实棋盘
- 最后一步会有特殊高亮显示

### 信息面板
- **游戏标题**："五子棋游戏"
- **当前玩家显示**：显示当前该谁落子
- **游戏状态**：显示游戏进度和结果
- **错误消息**：显示操作错误或提示信息
- **控制按钮**：开始游戏、重新开始

## 消息协议

### 落子请求 (PlaceStoneRequest)
```json
{
  "Row": 7,
  "Col": 7,
  "PlayerId": 1
}
```

### 游戏状态更新 (GameStateUpdateMessage)
```json
{
  "Board": "15x15二维数组",
  "State": "InProgress",
  "CurrentPlayer": "Black",
  "Player1Id": 1,
  "Player2Id": 5,
  "MoveCount": 10,
  "LastMove": {"Row": 7, "Col": 7},
  "Timestamp": "2024-01-01T00:00:00Z"
}
```

### 游戏结束 (GameOverMessage)
```json
{
  "FinalState": "BlackWins",
  "WinnerId": 1,
  "WinningLine": [
    {"Row": 7, "Col": 3},
    {"Row": 7, "Col": 4},
    {"Row": 7, "Col": 5},
    {"Row": 7, "Col": 6},
    {"Row": 7, "Col": 7}
  ],
  "TotalMoves": 25,
  "GameDuration": "00:05:30"
}
```

## 扩展功能

框架支持以下扩展：

1. **观战模式**：可以添加观战者功能
2. **游戏回放**：记录并回放游戏过程
3. **AI对战**：添加AI玩家
4. **排行榜**：统计玩家胜负记录
5. **房间系统**：支持多个游戏房间
6. **聊天功能**：游戏中聊天系统

## 注意事项

- 确保服务器和客户端都正确注册了游戏类
- 玩家ID必须为1和5才能参与游戏
- 游戏状态完全由服务器控制，客户端只负责显示
- 所有输入验证都在服务器端进行
- 网络断线重连后会自动同步游戏状态 